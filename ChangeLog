2006-10-17  Kevin P. Fleming  <kpfleming@digium.com>

	* Asterisk 1.4.0-beta3 released.

2006-10-17 22:31 +0000 [r45408-45410]  Kevin P. Fleming <kpfleming@digium.com>

	* include/asterisk/stringfields.h, main/ast_expr2.c,
	  main/channel.c, channels/chan_sip.c, channels/chan_iax2.c:
	  optimize the 'quick response' code a bit more... no more malloc()
	  or memset() for each response expand stringfields API a bit to
	  allow reusing the stringfield pool on a structure when needed,
	  and remove some unnecessary code when the structure was being
	  freed

2006-10-17 20:38 +0000 [r45378-45381]  Joshua Colp <jcolp@digium.com>

	* channels/chan_sip.c: Don't create a "real" pvt structure for
	  requests that shouldn't be able to create one. Instead use a
	  temporary pvt and fill it with enough information so we can send
	  a reply.

2006-10-17 17:39 +0000 [r45329]  Olle Johansson <oej@edvina.net>

	* configs/sip.conf.sample: Adding information about Marks
	  direct-RTP hack to the docs...

2006-10-17 17:22 +0000 [r45327]  Kevin P. Fleming <kpfleming@digium.com>

	* LICENSE: provide licensing language for IAXy firmware file

2006-10-16 20:06 +0000 [r45246-45280]  Joshua Colp <jcolp@digium.com>

	* apps/app_dial.c, apps/app_directed_pickup.c: Backport of new
	  directed pickup (BE-85).

2006-10-16 13:59 +0000 [r45196-45213]  Olle Johansson <oej@edvina.net>

	* CREDITS: Adding Inotel to credits for SIP transfers. Thanks for
	  your support!

	* channels/chan_sip.c: Don't destroy dialog for unexpected REFER
	  response...

2006-10-14 04:38 +0000 [r45143]  Steve Murphy <murf@digium.com>

	* funcs/func_rand.c: update the doc string for both AEL and
	  extensions.conf users.

2006-10-13 23:02 +0000 [r45125]  Kevin P. Fleming <kpfleming@digium.com>

	* main/acl.c don't drop the entire permit/deny list when an attempt
	  is made to add an invalid entry (BE-92)

2006-10-13 21:06 +0000 [r45104-45106]  Joshua Colp <jcolp@digium.com>

	* res/res_speech.c: Clear the quiet flag too since we are
	  restarting a recognition again (reported on -dev by Stephan
	  Edelman)

	* res/res_speech.c: Check return value from engine in case of
	  failure (ie: out of licenses) (reported on -dev mailing list)

2006-10-13 20:52 +0000 [r45103]  Steve Murphy <murf@digium.com>

	* pbx/ael/ael-test/ref.ael-vtest17 (added),
	  pbx/ael/ael-test/ael-vtest17/extensions.ael (added),
	  pbx/ael/ael-test/ael-vtest17 (added),
	  pbx/ael/ael-test/ref.ael-test3, pbx/pbx_ael.c: Bug 8128 fixed in
	  this release via these changes

2006-10-13 19:19 +0000 [r45088]  Christian Richter <christian.richter@beronet.com>

	* channels/chan_misdn.c: avoiding warning, fixing potential bug

2006-10-13 18:42 +0000 [r45051-45079]  Joshua Colp <jcolp@digium.com>

	* codecs/lpc10/placev.c, codecs/lpc10/irc2pc.c,
	  codecs/lpc10/decode.c, codecs/lpc10/dcbias.c,
	  codecs/lpc10/pitsyn.c, codecs/lpc10/voicin.c,
	  codecs/lpc10/difmag.c, codecs/lpc10/hp100.c,
	  codecs/lpc10/synths.c, codecs/lpc10/preemp.c,
	  codecs/lpc10/rcchk.c, codecs/lpc10/lpfilt.c,
	  codecs/lpc10/mload.c, codecs/lpc10/lpcenc.c,
	  codecs/lpc10/vparms.c, codecs/lpc10/dyptrk.c,
	  codecs/lpc10/lpcini.c, codecs/lpc10/random.c,
	  codecs/lpc10/ham84.c, codecs/lpc10/chanwr.c,
	  codecs/lpc10/placea.c, codecs/lpc10/tbdm.c,
	  codecs/lpc10/analys.c, codecs/lpc10/onset.c,
	  codecs/lpc10/energy.c, codecs/lpc10/deemp.c,
	  codecs/lpc10/lpcdec.c, codecs/lpc10/ivfilt.c,
	  codecs/lpc10/median.c, codecs/lpc10/encode.c,
	  codecs/lpc10/bsynz.c, codecs/lpc10/prepro.c,
	  codecs/lpc10/invert.c: And file said... let the compiler warnings
	  STOP!

	* apps/app_chanspy.c: Turn on volume adjustment if it needs to be on (issue #8136
	  reported by mnicholson)

	* apps/app_playback.c: Move say.conf existence check to do_say
	  function since it is called from multiple places (issue #8144
	  reported by kshumard)

2006-10-13 16:19 +0000 [r45049]  Kevin P. Fleming <kpfleming@digium.com>

	* channels/chan_iax2.c: when sending a call to a peer, use the proper socket if
	  we have multiple bindings (reported on asterisk-dev)

2006-10-13 16:01 +0000 [r45031-45040]  Joshua Colp <jcolp@digium.com>

	* channels/chan_sip.c: Complete merging in RPID screen changes
	  (issue #8101 reported by hristo, patch by oej in revision 44757)

	* main/dnsmgr.c: Pass the right value to usleep for sleeping, and always add
	  the background refresh item back into the scheduler if enabled
	  since it is deleted during reload. (issue #8142 reported by
	  p_lindheimer)

2006-10-13 15:41 +0000 [r45027]  Kevin P. Fleming <kpfleming@digium.com>

	* configure, include/asterisk/autoconfig.h.in, configure.ac,
	  main/utils.c: use a configure script test for PMTU discovery
	  control instead of just assuming it's available on Linux

2006-10-13 14:45 +0000 [r44994-45026]  Christian Richter <christian.richter@beronet.com>

	* channels/misdn/isdn_lib.c, channels/chan_misdn.c: fixed some
	  echocandisable issues when bridged. this caused a kernel panic
	  sometimes.. also some minor formatting fixes

	* channels/misdn/isdn_msg_parser.c: fixed issue that the hangupcause
	  got a wrong isdn cause at RELEASE_COMPLETE

2006-10-12 22:07 +0000 [r44992]  Luigi Rizzo <rizzo@icir.org>

	* channels/chan_sip.c: merge formatting and minor code
	  simplifications from trunk

2006-10-12 20:34 +0000 [r44982]  Matt O'Gorman <mogorman@digium.com>

	* channels/chan_gtalk.c: fix for bug 7764.

2006-10-12 19:14 +0000 [r44956-44971]  Kevin P. Fleming <kpfleming@digium.com>

	* channels/chan_sip.c: we can only send one 'a=ptime' attribute per
	  media session, not one for each format

	* main/netsock.c, include/asterisk/utils.h, channels/chan_sip.c,
	  main/utils.c: ensure that IAX2 and SIP sockets allow UDP
	  fragmentation when running on Linux (thanks to Brian Candler on
	  the asterisk-dev list for the tip)

2006-10-12 16:56 +0000 [r44945]  Russell Bryant <russell@digium.com>

	* main/manager.c: fix a silly typo in a comment that I saw while
	  reading the commit list

2006-10-12 16:08 +0000 [r44942]  Joshua Colp <jcolp@digium.com>

	* Makefile: Pass off AUDIO_LIBS so muted can link on OSX (issue
	  #8135 reported by ssokol)

2006-10-12 12:55 +0000 [r44921]  Nadi Sarrar <ns@beronet.com>

	* main/manager.c: append_event must be called while holding the
	  session lock

2006-10-12 10:24 +0000 [r44911]  Russell Bryant <russell@digium.com>

	* res/res_jabber.c: change some debug output to use LOG_DEBUG
	  instead of verbose output

2006-10-11 16:57 +0000 [r44888]  Jason Parker <jparker@digium.com>

	* main/db1-ast/Makefile: These are already set by the parent
	  Makefile.. There is no need to have this here (it doesn't
	  actually work anyways).

2006-10-11 09:18 +0000 [r44854]  Christian Richter <christian.richter@beronet.com>

	* channels/misdn/isdn_lib.c: removed warning because of missing
	  prototype declaration

2006-10-10 19:23 +0000 [r44830]  Olle Johansson <oej@edvina.net>

	* channels/chan_sip.c: Do not set default/global values in the
	  variable declaration, set it in reload_config()

2006-10-10 17:21 +0000 [r44819]  Joshua Colp <jcolp@digium.com>

	* channels/chan_sip.c: Move some stuff around so that a NOTIFY
	  dialog won't hang around until the end of the world under certain
	  circumstances

2006-10-10 16:44 +0000 [r44809]  Paul Cadach <paul@odt.east.telecom.kz>

	* main/channel.c, funcs/func_channel.c, include/asterisk/channel.h:
	  CHANNEL() function sometime mix parameter and value

2006-10-10 16:42 +0000 [r44808]  Tilghman Lesher <tilghman@mail.jeffandtilghman.com>

	* funcs/func_logic.c: Lost of a bit of logic when this was
	  simplified between 1.2 and 1.4 (Bug 8117)

2006-10-10 16:30 +0000 [r44806]  Joshua Colp <jcolp@digium.com>

	* channels/chan_sip.c: Bail out if we have no refer structure and
	  we get a refer response

2006-10-10 16:21 +0000 [r44805]  Luigi Rizzo <rizzo@icir.org>

	* channels/chan_sip.c: more merge from trunk (comments and change a
	  static function name)

2006-10-10 15:23 +0000 [r44788]  Joshua Colp <jcolp@digium.com>

	* channels/chan_sip.c: Only set DTMF information if an RTP
	  structure exists

2006-10-10 13:50 +0000 [r44786]  Christian Richter <christian.richter@beronet.com>

	* channels/misdn/isdn_lib.c, channels/chan_misdn.c: (re)added
	  support of dynamically enabling hdlc on bchannels

2006-10-10 08:25 +0000 [r44776-44777]  Luigi Rizzo <rizzo@icir.org>

	* channels/chan_sip.c: whitespace changes related to previous
	  commit

	* channels/chan_sip.c: merge a few code simplifications that have
	  gone into trunk during last week, to reduce differences between
	  the two branches and make porting fixes easier.

2006-10-09 16:12 +0000 [r44764]  Jason Parker <jparker@digium.com>

	* channels/chan_skinny.c: Fix a problem where phones that go
	  "missing" never got unregistered. Issue #8067, reported by pj,
	  patch by Anthony LaMantia (with minor whitespace modifications)

2006-10-09 15:46 +0000 [r44759-44760]  Joshua Colp <jcolp@digium.com>

	* channels/chan_iax2.c: iaxs[callno] may go away if we try to avoid
	  the deadlock

	* channels/chan_iax2.c: Properly avoid a collision with iax2_hangup
	  (issue #8115 reported by vazir)

2006-10-08 14:14 +0000 [r44746]  Luigi Rizzo <rizzo@icir.org>

	* channels/chan_sip.c: do not dereference p if we
	  know it is NULL

2006-10-07 14:39 +0000 [r44684]  Paul Cadach <paul@odt.east.telecom.kz>

	* channels/h323/ast_h323.cxx, channels/chan_h323.c,
	  channels/h323/ast_h323.h, channels/h323/chan_h323.h: Propagate
	  caller's transfer capability too

2006-10-07 11:37 +0000 [r44650-44665]  Luigi Rizzo <rizzo@icir.org>

	* channels/chan_sip.c: put common code in a
	  function to avoid repetitions.

	* channels/chan_sip.c: remove hardwired usage of 5060, use
	  DEFAULT_SIP_PORT instead

	* channels/chan_sip.c: option_debug checking
	  before printing to debug channel.

	* channels/chan_sip.c: backport simplifications on sip_register,
	  usage of ast_set2_flag(), and fixes to the handling of failed
	  module loading.

	* channels/chan_sip.c: improve and document function
	  get_in_brackets(), introducing a helper function
	  find_closing_quote() of more general use.

2006-10-06 21:28 +0000 [r44629-44631]  Kevin P. Fleming <kpfleming@digium.com>

	* include/asterisk/linkedlists.h: ensure that mutex locks inside
	  list heads are initialized properly on platforms that require
	  constructor initialization (issue #8029, patch from timrobbins)

	* CHANGES: remove Jingle as per mog

2006-10-06 21:08 +0000 [r44628]  Joshua Colp <jcolp@digium.com>

	* main/rtp.c: Remove the seqno check for RFC2833, the handler is
	  smart enough to not need it.

2006-10-06 21:07 +0000 [r44627]  Kevin P. Fleming <kpfleming@digium.com>

	* CHANGES: various cleanups

2006-10-06 18:46 +0000 [r44581-44605]  Joshua Colp <jcolp@digium.com>

	* main/rtp.c: When the sequence number rolls over then reset the
	  recorded sequence number for DTMF (issue #8106 reported by
	  bungalow)

	* main/file.c: Even more frames to treat as though the remote side
	  disappeared (issue #8097 reported by eldadran)

2006-10-06 15:59 +0000 [r44567]  Luigi Rizzo <rizzo@icir.org>

	* main/manager.c, main/http.c: make sure sockets are blocking when
	  they should be blocking.

2006-10-06 12:53 +0000 [r44559-44563]  Christian Richter <christian.richter@beronet.com>

	* channels/chan_misdn.c: fixed segfault which happens during
	  hold/transfer action

	* channels/chan_misdn.c: if INFORMATION Message come with keypad
	  instead of called party number, we just use the keypad as called
	  party number.

	* channels/misdn/isdn_lib.c, channels/misdn_config.c,
	  channels/misdn/isdn_lib.h, channels/chan_misdn.c,
	  channels/misdn/chan_misdn_config.h, configs/misdn.conf.sample:
	  added the option 'reject_cause' to make it possible to set
	  the RELEASE_COMPLETE - cause on the 3. incoming PMP channel,
	  which is automatically rejected because chan_misdn does not
	  support that kind of callwaiting. Therefore chan_misdn supports
	  now 3 incoming channels on a PMP BRI Port. misdn_lib_get_free_bc
	  now gets the info if the requested channel is incoming or
	  outgoing to make the 3. channel possible

	* channels/misdn/isdn_lib.c, channels/misdn/isdn_lib.h,
	  channels/chan_misdn.c: fixed the hold/retrieve/transfer issues,
	  removed a useless bc field, added setting of frame.delivery fields,
	  some minor code cleanups

2006-10-05 19:57 +0000 [r44502]  Joshua Colp <jcolp@digium.com>

	* main/file.c: Treat busy control frames as hangup in the file streaming
	  core (issue #8097 reported by eldadran)

2006-10-05 18:21 +0000 [r44488]  Steve Murphy <murf@digium.com>

	* pbx/pbx_ael.c: This mod fixes a problem pointed out by dgarstang.
	  Many thanks to Doug!

2006-10-05 18:01 +0000 [r44486]  Joshua Colp <jcolp@digium.com>

	* channels/chan_sip.c: One more T.38 fix! Don't leave a reinvite
	  hanging by a thread if the other side is already setup with T.38

2006-10-05 16:10 +0000 [r44476]  Kevin P. Fleming <kpfleming@digium.com>

	* main/app.c: don't segfault when an argument without a close
	  parenthesis is found stop parsing as soon as that situation
	  occurs

2006-10-05 15:22 +0000 [r44465-44466]  Steve Murphy <murf@digium.com>

	* CHANGES: I put the accumulated changes from the commit logs and
	  inspection, into CHANGES. Hope everyone approves!

	* configs/muted.conf.sample, utils/muted.c: Hang on a minute, the
	  install process sticks muted.conf in /etc/asterisk, so that's
	  where muted should look for it, right?

2006-10-05 02:40 +0000 [r44450]  Joshua Colp <jcolp@digium.com>

	* channels/chan_sip.c: Don't totally bail out if T.38 was
	  negotiated

2006-10-05 01:42 +0000 [r44433-44436]  Kevin P. Fleming <kpfleming@digium.com>

	* channels/chan_sip.c: fix Polycom presence notification again

2006-10-04 22:52 +0000 [r44407-44409]  Luigi Rizzo <rizzo@icir.org>

	* utils/Makefile: as far as i can tell astman only uses newt...

	* Makefile: put linker flags in ASTLDFLAGS where they belong

2006-10-04 21:17 +0000 [r44390-44393]  Kevin P. Fleming <kpfleming@digium.com>

	* channels/chan_sip.c: remove workaround for old Polycom firmware SUBSCRIBE
	  requests add workaround for new Polycom firmware SUBSCRIBE
	  requests (bug is known to exist in 2.0.1 firmware)

	* include/asterisk.h, main/utils.c: make LOW_MEMORY builds actually
	  work

2006-10-04 19:57 +0000 [r44380]  Steve Murphy <murf@digium.com>

	* pbx/ael/ael-test/ref.ael-ntest10, pbx/ael/ael.tab.c,
	  pbx/ael/ael-test/ref.ael-test1, pbx/ael/ael-test/ref.ael-ntest12,
	  pbx/ael/ael-test/ref.ael-test2, pbx/ael/ael-test/ref.ael-test3,
	  pbx/pbx_ael.c, pbx/ael/ael-test/ref.ael-test4,
	  pbx/ael/ael-test/ref.ael-test5, pbx/ael/ael-test/ref.ael-test6,
	  pbx/ael/ael-test/ref.ael-test7, pbx/ael/ael-test/ref.ael-test8,
	  pbx/ael/ael-test/ael-test16/extensions.ael (added),
	  pbx/ael/ael-test/ael-test16 (added), pbx/ael/ael.y,
	  pbx/ael/ael-test/ref.ael-test11, pbx/ael/ael-test/ref.ael-test14,
	  pbx/ael/ael-test/ref.ael-test15, pbx/ael/ael-test/ref.ael-ntest9,
	  pbx/ael/ael-test/ref.ael-test16 (added): These changes fix the
	  problems reported in bug 8090

2006-10-04 19:47 +0000 [r44378]  Kevin P. Fleming <kpfleming@digium.com>

	* channels/chan_oss.c, main/cdr.c, channels/chan_phone.c,
	  main/manager.c, pbx/pbx_spool.c, res/res_smdi.c,
	  channels/chan_skinny.c, channels/chan_h323.c, main/http.c,
	  channels/chan_alsa.c, pbx/pbx_dundi.c, apps/app_mixmonitor.c,
	  main/asterisk.c, channels/chan_mgcp.c, main/autoservice.c,
	  include/asterisk/utils.h, main/dnsmgr.c, channels/chan_zap.c,
	  channels/chan_sip.c, apps/app_meetme.c, res/res_snmp.c,
	  main/devicestate.c, main/utils.c, res/res_musiconhold.c,
	  channels/chan_iax2.c, apps/app_queue.c, res/res_jabber.c: update
	  thread creation code a bit reduce standard thread stack size
	  slightly to allow the pthreads library to allocate the stack+data
	  and not overflow a power-of-2 allocation in the kernel and waste
	  memory/address space add a new stack size for 'background'
	  threads (those that don't handle PBX calls) when LOW_MEMORY is
	  defined

2006-10-04 17:04 +0000 [r44337-44365]  Steve Murphy <murf@digium.com>

	* configs/muted.conf.sample: I've been meaning to add some
	  explanation about muted... here it is

	* configs/manager.conf.sample: CLI reverbification update to this
	  config file

	* apps/app_macro.c: In response to bug 7776, a Warning has been
	  added to the doc string for Macro().

2006-10-04 00:25 +0000 [r44322]  Kevin P. Fleming <kpfleming@digium.com>

	* main/asterisk.c, main/loader.c, main/term.c, Makefile,
	  include/asterisk.h: ensure that local include files are always
	  used avoid a duplicate function name (term_init())

2006-10-03 22:35 +0000 [r44312]  Matt O'Gorman <mogorman@digium.com>

	* channels/chan_gtalk.c, res/res_jabber.c: fix issue with dialing
	  client without resource.

2006-10-03 20:18 +0000 [r44298]  Kevin P. Fleming <kpfleming@digium.com>

	* apps/app_queue.c: fix a logic error in my previous fix to the queue
	  reload code

2006-10-03 18:42 +0000 [r44286]  Paul Cadach <paul@odt.east.telecom.kz>

	* channels/h323/ast_h323.cxx: Change default presentation indicator
	  to "user provided not screened" if octet 3a missed in
	  CallingPartyNumber IE

2006-10-03 18:35 +0000 [r44284]  Joshua Colp <jcolp@digium.com>

	* channels/chan_sip.c: Use VideoSupport instead so it is considered
	  a valid XML attribute name. (issue #8075 reported by renemendoza)

2006-10-03 18:30 +0000 [r44283]  Paul Cadach <paul@odt.east.telecom.kz>

	* channels/h323/ast_h323.cxx: Fix preparation of type and
	  presentation of calling number

2006-10-03 00:01 +0000 [r44240]  Matt O'Gorman <mogorman@digium.com>

	* doc/jingle.txt, channels/chan_jingle.c (removed),
	  include/asterisk/jabber.h, configs/jingle.conf.sample (removed),
	  res/res_jabber.c: updated res_jabber for even better component
	  support, soon will be jep-0100 compliant. also removed
	  chan_jingle and infromed info from jingle.txt, chan_gtalk still
	  works and should be used in this version.

2006-10-02 20:11 +0000 [r44199-44215]  Joshua Colp <jcolp@digium.com>

	* channels/chan_sip.c: Change the fd on the I/O context in case it
	  changed during the reload, which is indeed possible. (issue #7943
	  reported by eclubb)

	* contrib/init.d/rc.redhat.asterisk: We should be using $AST_SBIN
	  instead of hardcoding the path for the error message (issue #7942
	  reported by eclubb)

2006-10-02 18:52 +0000 [r44186]  Paul Cadach <paul@odt.east.telecom.kz>

	* configs/users.conf.sample, pbx/pbx_config.c: Missed part of
	  userconf functionality for chan_h323

2006-10-02 17:25 +0000 [r44169]  Joshua Colp <jcolp@digium.com>

	* main/io.c: Shrink when current_ioc is unused. It is set to -1 when
	  unused, not 0. (issue #7941 reported by eclubb)

2006-10-02 17:16 +0000 [r44166-44167]  Paul Cadach <paul@odt.east.telecom.kz>

	* doc/realtime.txt: Typo fix

	* channels/chan_h323.c: Optimization of oh323_indicate(): less
	  locks - less problems, plus single exit point

2006-10-02 02:38 +0000 [r44146]  Mark Spencer <markster@digium.com>

	* channels/chan_sip.c, channels/chan_iax2.c: Don't use Channel when
	  you're not talking about a channel :)

2006-10-01 19:32 +0000 [r44135]  Paul Cadach <paul@odt.east.telecom.kz>

	* channels/chan_h323.c: Do not simulate any audio tones if we got
	  PROGRESS message

2006-10-01 18:30 +0000 [r44111-44125]  Russell Bryant <russell@digium.com>

	* Makefile: Fix a problem that cuased AST_DATA_DIR in defaults.h to
	  be empty. The cause is that since ASTDATADIR is explicitly
	  exported using "export ASTDATADIR" at the top of the Makefile,
	  make no longer considers the variable "undefined", so the
	  Makefile can't use ?= to set ASTDATADIR if not yet set. (issue
	  #8063, reported by akohlsmith, fixed by me)

	* configs/queues.conf.sample: Fix the name of the "eventmemberstatus"
	  option in the sample queues.conf (issue #8065, adamg)

2006-10-01 15:01 +0000 [r44109]  Luigi Rizzo <rizzo@icir.org>

	* channels/chan_sip.c: sync with trunk - move variable declarations
	  to the beginning of a block.

2006-09-30 19:20 +0000 [r44090]  Paul Cadach <paul@odt.east.telecom.kz>

	* main/rtp.c: Allow one-way RTP streams (device->Asterisk)

2006-09-30 16:28 +0000 [r44080]  Luigi Rizzo <rizzo@icir.org>

	* codecs/lpc10/Makefile, Makefile, main/Makefile: fix two recent
	  build problems: - with AST_DEVMODE, building codecs/lpc10 fails
	  because of lots of warnings, and the configure step in editline
	  fails as well. Fix this by removing the -Werror in these steps. -
	  on FreeBSD (but probably on other platforms as well), the final
	  link of asterisk fails because AST_LIBS was not exported to the
	  subdirs Makefiles. Add a proper fix in the top-level Makefile (a
	  possible alternative way is to add "export AST_LIBS" near the
	  beginning of the file). With this fix, i believe that some of the
	  platform-specific conditionals in main/Makefile are redundant
	  (because they should be already dealt with in the top level
	  Makefile) but i don't have a platform to check. Merging to head
	  will happen in a moment.

2006-09-30 16:12 +0000 [r44068-44078]  Paul Cadach <paul@odt.east.telecom.kz>

	* channels/chan_sip.c: Fix issue #7928 correctly. Next is a comment
	  of previous fix: Issue #7928 - Don't send both 404 and 503. Fix
	  by phsultan with a small fix by me, myself or I. Thanks,
	  Philippe! (This was caused by my changes to the transaction
	  handling)

	* channels/chan_sip.c: Found some buggy SIP clients (phones Planet
	  VIP-153T firmware 1.0, Linksys PAP2 firmware 3.1.9(LSc)) which
	  sends ACK not on OK message only (when remote party answers) but
	  on RINGING message too, so when we send 200 OK message, we get
	  unidentified ACK message (because INVITE acknowledged on RINGING
	  message already), so 200 OK retransmits within its retransmission
	  interval then call gets dropped. If someone else knows how to
	  provide workaround for such cases, please, fix it in correct way.
	  Thanks to ssh from #asteriskru for provide access to his box to
	  study and fix this case.

2006-09-29 22:51 +0000 [r44055-44057]  Kevin P. Fleming <kpfleming@digium.com>

	* agi, utils: ignore temporary files made by the Makefiles during a
	  build

	* codecs/lpc10/Makefile, main/db1-ast/Makefile, agi/Makefile,
	  codecs/Makefile, utils/Makefile, configure,
	  build_tools/embed_modules.xml, codecs/gsm/Makefile, configure.ac,
	  Makefile.moddir_rules, Makefile.rules, codecs/ilbc/Makefile,
	  pbx/Makefile, res/Makefile, channels/Makefile: fix a few build
	  system bugs, and convert Makefiles to be compatible with GNU make
	  3.80

2006-09-29 22:35 +0000 [r44053]  Jason Parker <jparker@digium.com>

	* main/asterisk.c, main/cli.c: Fix a bug with the removal of
	  'atleast' argument to 'core verbose' and 'core debug'. Add that
	  argument back in.

2006-09-29 21:09 +0000 [r44022-44043]  Paul Cadach <paul@odt.east.telecom.kz>

	* channels/h323/ast_h323.cxx: Set TON/PRESENTATION information more
	  carefully when no CallingNumber IE available

	* channels/h323/ast_h323.cxx: Fake display name by called number on
	  incoming calls (until passing connected number/connected name is
	  not implemented)

	* channels/h323/ast_h323.cxx: Ported code refers to H.450 - add
	  includes

	* channels/h323/ast_h323.cxx, channels/h323/ast_h323.h: Properly
	  pass TON/PRESENTATION information - original
	  H323Connection::SendSignalSetup() destroys Q.931 fields.

2006-09-29 18:49 +0000 [r44011-44012]  Kevin P. Fleming <kpfleming@digium.com>

	* main/Makefile: yet another place where we were not using the
	  correct CFLAGS by default

	* main/Makefile: missed one conversion to ASTCFLAGS

2006-09-29 18:30 +0000 [r44009]  Paul Cadach <paul@odt.east.telecom.kz>

	* channels/h323/ast_h323.cxx, channels/chan_h323.c,
	  channels/h323/ast_h323.h, channels/h323/chan_h323.h: Pass
	  TON/PRESENTATION information too

2006-09-29 18:25 +0000 [r43952-44008]  Kevin P. Fleming <kpfleming@digium.com>

	* main/db1-ast/Makefile, Makefile, codecs/Makefile, utils/Makefile,
	  main/Makefile, codecs/gsm/Makefile, Makefile.moddir_rules,
	  Makefile.rules, pbx/Makefile, channels/Makefile: don't abuse
	  CFLAGS and LDFLAGS for build of Asterisk components, because they
	  are also then used for non-Asterisk components (like menuselect);
	  use our own variables instead

	* configure, configure.ac: support --without-curl in configure
	  script

	* Makefile.rules: another cross-compile fix

	* Makefile: a couple more environment settings that can't leak into
	  the menuselect build

	* main/cli.c: proper fix for ast_group_t change

	* include/asterisk/lock.h: eliminate compiler warning when
	  DEBUG_CHANNEL_LOCKS is enabled and users of this header file
	  don't also include channel.h

2006-09-28 20:11 +0000 [r43944]  Jason Parker <jparker@digium.com>

	* apps/app_queue.c: Fix incorrect argument order for member names,
	  on persisted members. Issue 8047, patch by jmls.

2006-09-28 18:05 +0000 [r43932-43933]  Joshua Colp <jcolp@digium.com>

	* apps/app_playback.c, res/res_monitor.c,
	  include/asterisk/logger.h, channels/chan_misdn.c, res/res_smdi.c,
	  channels/chan_skinny.c, apps/app_rpt.c, channels/chan_mgcp.c,
	  main/udptl.c, main/frame.c, funcs/func_timeout.c,
	  channels/chan_sip.c, apps/app_festival.c,
	  channels/iax2-provision.c, apps/app_alarmreceiver.c,
	  res/res_musiconhold.c, apps/app_followme.c, channels/chan_iax2.c:
	  Put in missing \ns on the end of ast_logs (issue #7936 reported
	  by wojtekka)

2006-09-28 17:35 +0000 [r43919]  Kevin P. Fleming <kpfleming@digium.com>

	* apps/app_queue.c: fix buggy (and overly complex) loop used during reload
	  of app_queue for static member list updating

2006-09-28 17:34 +0000 [r43918]  Paul Cadach <paul@odt.east.telecom.kz>

	* channels/h323/ast_h323.cxx: Extend call establishment timeout

2006-09-28 17:31 +0000 [r43913-43915]  Joshua Colp <jcolp@digium.com>

	* channels/chan_iax2.c: Make sure the pvt exists before accessing
	  it again as it may have gone away (issue #7562 reported by Seb7
	  and issue #7939 reported by sorg)

	* main/cli.c: Warning be gone!

2006-09-28 16:41 +0000 [r43899]  BJ Weschke <bweschke@btwtech.com>

	* apps/app_queue.c: app_queue is comparing the device names incorrectly
	  while checking their statuses. It's internal list of interfaces
	  includes the dial string, while the argument passed to this
	  function does not have the dial string (/n for a local channel).
	  This causes it to ignore the device state changes because it
	  thinks it belongs to none of its members. (#8040 reported and
	  patch by tim_ringenbach)

2006-09-28 16:17 +0000 [r43893]  Joshua Colp <jcolp@digium.com>

	*  apps/app_meetme.c: Stop the stream after waitstream returns so that our
	  formats get restored. (issue #7370 reported by kryptolus)

2006-09-28 15:56 +0000 [r43877]  Paul Cadach <paul@odt.east.telecom.kz>

	* channels/h323/ast_h323.cxx: Fix compiler warning

2006-09-28 15:29 +0000 [r43864-43873]  BJ Weschke <bweschke@btwtech.com>

	* apps/app_queue.c: Fix race conditioon crash with get_member_status (#7864 -
	  tim_ringenbach reported and patched)

	* apps/app_queue.c: Autopause not working for queue members. (#8042
	  - jmls reported and patch)

2006-09-28 12:58 +0000 [r43861-43862]  Paul Cadach <paul@odt.east.telecom.kz>

	* channels/h323/ast_h323.cxx, channels/h323/ast_h323.h: Force
	  remote side to start media on outgoing PROGRESS message

	* include/asterisk/compiler.h: Put attribute tag at correct place

2006-09-28 11:03 +0000 [r43852]  Christian Richter <christian.richter@beronet.com>

	* channels/misdn/isdn_lib.c, channels/misdn/isdn_lib.h,
	  channels/chan_misdn.c: fixed a bug which led to chan_list zombies,
	  when the call could not be properly established in misdn_call.
	  also removed the ACK_HDLC stuff which is not really needed.

2006-09-28 10:51 +0000 [r43843-43846]  Paul Cadach <paul@odt.east.telecom.kz>

	* channels/h323/ast_h323.cxx: Do not open transmit channel until
	  TCS is received

	* main/file.c: Don't warn on HOLD/UNHOLD control frames

	* main/file.c: Don't treat unknown control frames as voice

2006-09-27 20:21 +0000 [r43816]  Tilghman Lesher <tilghman@mail.jeffandtilghman.com>

	* apps/app_voicemail.c: Avoid inability to lock directory log message by
	  creating the directory ahead of time. (Issue 7631)

2006-09-27 19:44 +0000 [r43801-43803]  Jason Parker <jparker@digium.com>

	* apps/app_playback.c, main/pbx.c: Fix an issue with PLAYBACKSTATUS
	  not being set under certain circumstances. Fix a minor issue, to
	  make it use the filenames that were parsed, instead of the entire
	  argument string. Fix Background() to return -1 like Playback(),
	  if no args are specified.

2006-09-27 19:10 +0000 [r43783-43798]  Joshua Colp <jcolp@digium.com>

	* main/rtp.c: Compensate for out of order packets better if RFC2833
	  compensation is turned on.

	* channels/chan_iax2.c: Get rid of two functions from a time now
	  past (we THINK these are from pre-recursive lock time) that may
	  be contributing to two open issues on the bug tracker (7562/7939)
	  and that has the potential to just make bad things happen if the
	  timing is right.

2006-09-27 16:55 +0000 [r43779]  Russell Bryant <russell@digium.com>

	* main/channel.c,res/res_features.c: Fix a problem that occurred if
	  a user entered a digit
	  that matched a bridge feature that was configured using multiple
	  digits, and the digit that was pressed timed out in the feature
	  digit timeout period. For example, if blind transfer is
	  configured as '##', and a user presses just '#'. In this
	  situation, the call would lock up and no longer pass any frames.
	  (issue #7977 reported by festr, and issue #7982 reported by
	  michaels and valuable input provided by mneuhauser and kuj. Fixed
	  by me, with testing help and peer review from Joshua Colp). There
	  are a couple of issues involved in this fix: 1) When
	  ast_generic_bridge determines that there has been a timeout, it
	  returned AST_BRIDGE_RETRY. Then, when ast_channel_bridge gets
	  this result, it calls ast_generic_bridge over again with the same
	  timestamp for the next event. This results in an endless loop of
	  nothing until the call is terminated. This is resolved by simply
	  changing ast_generic_bridge to return AST_BRIDGE_COMPLETE when it
	  sees a timeout. 2) I also changed ast_channel_bridge such that if
	  in the process of calculating the time until the next event, it
	  knows a timeout has already occured, to immediately return
	  AST_BRIDGE_COMPLETE instead of attempting to bridge the channels
	  anyway. 3) In the process of testing the previous two changes, I
	  ran into a problem in res_features where ast_channel_bridge would
	  return because it determined that there was a timeout. However,
	  ast_bridge_call in res_features would then determine by its own
	  calculation that there was still 1 ms before the timeout really
	  occurs. It would then proceed, and since the bridge broke out and
	  did *not* return a frame, it interpreted this as the call was
	  over and hung up the channels. The reason for this was because
	  ast_bridge_call in res_features and ast_channel_bridge in
	  channel.c were using different times for their calculations.
	  channel.c uses the start_time on the bridge config, which is the
	  time that the feature digit was recieved. However, res_features
	  had another time, 'start', which was set right before calling
	  ast_channel_bridge. 'start' will always be slightly after
	  start_time in the bridge config, and sometimes enough to round up
	  to one ms. This is fixed by making ast_bridge_call use the same
	  time as ast_channel_bridge for the timeout calculation. ........

2006-09-27 16:24 +0000 [r43775]  Christian Richter <christian.richter@beronet.com>

	* channels/chan_misdn.c, channels/Makefile: removed the chan_misdn
	  versioning, since Asterisk has it's own

2006-09-27 16:23 +0000 [r43774]  Joshua Colp <jcolp@digium.com>

	* channels/chan_sip.c: Make rfc2833compensate a global option.

2006-09-27 04:35 +0000 [r43756]  Russell Bryant <russell@digium.com>

	* apps/app_voicemail.c: Backport revision 43754 from the trunk,
	  which removes an unused buffer from mm_login to close bug 8038,
	  as well as addresses some formatting and coding guidelines issues
	  in passing. Originally, I did not commit this to 1.4 since it is
	  not necessarily fixing a bug. However, since the IMAP storage
	  code is brand new, I decided it would be better to make the
	  change here as well, in case someone has to work on this code to
	  address issues in the very near future. I don't want to make
	  unnecessary merge problems going to the trunk.

2006-09-27 02:32 +0000 [r43739]  Steve Murphy <murf@digium.com>

	* configs/extensions.ael.sample: This change to extensions.ael was
	  to fix bug 8031; the install scripts are causing it to be copied
	  to /etc/asterisk/extensions.ael, and because it is a fairly
	  direct conversion of the original extensions.conf, the macro and
	  context names clash with the existing extensions.conf. So, I put
	  an ael- in front of all macros and contexts, and checked every
	  goto and macro call. Also, this file compiles under aelparse.

2006-09-26 20:56 +0000 [r43710]  Russell Bryant <russell@digium.com>

	* main/asterisk.c: Back in revision 4798, this message was changed from
	  using ast_cli() to directly calling write(). During this change,
	  checking if this was a remote console was removed. This caused
	  this message about using "exit" or "quit" to exit an Asterisk
	  console to come up in times where it did not make sense. This
	  change restores the check to see if this is a remote console
	  before printing the message. (fixes BE-65)

2006-09-26 20:47 +0000 [r43707]  Joshua Colp <jcolp@digium.com>

	* .cleancount, main/cli.c, channels/chan_sip.c,
	  include/asterisk/channel.h: Use proper type to represent the group variable
	  (issue #8025 reported by makoto)

2006-09-26 20:30 +0000 [r43700-43703]  Russell Bryant <russell@digium.com>

	* channels/chan_sip.c: Add missing newline character in the warning
	  message about deprecated TOS values in configuration.

	* apps/app_voicemail.c: When parsing the sections of voicemail.conf that contain
	  mailbox definitions, don't introduce a length limit on the
	  definition by using a 256 byte temporary storage buffer. Instead,
	  make the temporary buffer just as big as it needs to be to hold
	  the entire mailbox definition. (fixes BE-68)

2006-09-26 20:19 +0000 [r43695-43697]  Joshua Colp <jcolp@digium.com>

	* channels/chan_local.c: Strip options off the argument passed for
	  devicestate in chan_local. (issue #8034 reported by pcardozo)

	* apps/app_chanspy.c, main/channel.c, main/slinfactory.c: Slight
	  overhaul of the whisper support. 1. We need to duplicate the
	  frame from ast_translate 2. We need to ensure we always have
	  signed linear coming in for signed linear combining. 3. We need
	  to ensure we are always feeding signed linear out. 4. Properly
	  store and restore write format when beeping on the channel we are
	  whispering on. 5. Properly discontinue the stream on the channel
	  for the beep. (issue #8019 reported by timkelly1980)

2006-09-26 18:34 +0000 [r43676]  Kevin P. Fleming <kpfleming@digium.com>

	* sounds/Makefile: update to use 1.4.3 core sounds, with corrected
	  beep/beeperr/tt-monkeys files

2006-09-26 18:08 +0000 [r43650-43674]  Jason Parker <jparker@digium.com>

	* doc/rtp-packetization.txt, main/frame.c: Issue #8015, patch by
	  Dan Austin. Maximum values were incorrect, which is why this is
	  being put in 1.4

	* channels/chan_skinny.c: Add proper codec support to chan_skinny.
	  Works with at least ulaw, alaw, and g729a. This is technically a
	  "new feature", but there are justifications for it. I found a bug
	  with the recent rtp packetization changes, which caused the media
	  setup to fail under certain circumstances, particularly when
	  using allow=all, or having no allow= statements (globally or on
	  the device). I could have either removed the rtp packetization
	  features, or I could add proper codec support (which, without, I
	  think most people would consider to be a bug anyways).

2006-09-25 22:07 +0000 [r43640-43642]  Tilghman Lesher <tilghman@mail.jeffandtilghman.com>

	* apps/app_voicemail.c: Should have moved these lines up in the
	  merge, instead of removing them

	* apps/app_voicemail.c: Two bugs when forwarding voicemail (Issue 7824): 1)
	  delete=yes was ignored 2) maxmessages was ignored

2006-09-25 21:26 +0000 [r43626-43635]  Paul Cadach <paul@odt.east.telecom.kz>

	* channels/h323/cisco-h225.cxx, channels/h323/cisco-h225.h,
	  channels/h323/cisco-h225.asn: Fix ASN1 description of
	  non-standard Cisco extensions

	* channels/h323/ast_h323.cxx, channels/chan_h323.c: Backport
	  changes of trunk: 1) r43540: Avoid possible deadlock on channel
	  destruction 2) r43590: Disable fastStart if requested by remote
	  side

2006-09-25 15:23 +0000 [r43616]  Jason Parker <jparker@digium.com>

	* sounds/Makefile: One more fix for sounds installation - this time
	  for portability. Reported to asterisk-dev mailing list.

2006-09-25 14:52 +0000 [r43605]  Steve Murphy <murf@digium.com>

	* formats/format_ogg_vorbis.c: This tiny fix prevents asterisk from
	  crashing if trying to play an OGG moh file.

2006-09-25 06:15 +0000 [r43582]  Paul Cadach <paul@odt.east.telecom.kz>

	* channels/h323/caps_h323.cxx, channels/h323/compat_h323.h,
	  channels/chan_h323.c: Merged revisions 43472,43495 from trunk

2006-09-24 14:58 +0000 [r43553-43564]  Russell Bryant <russell@digium.com>

	* channels/iax2-provision.c: Fix a CLI command registration issue
	  where an erroneous message claiming that "iax2 show provisioning"
	  was already registered. This was because this command was
	  registering itself as both the command, as well as the command it
	  is deprecating. (issue #8022, reported by bjweeks, fixed by
	  myself)

	* channels/chan_iax2.c:Check to see if the channel that is activating the
	  IAXPEER function is actually an IAX2 channel before proceeding to
	  process it to avoid crashing. (issue #8017, reported by admott,
	  fixed by myself)

2006-09-22 23:44 +0000 [r43524]  Kevin P. Fleming <kpfleming@digium.com>

	* Makefile: don't output the 'build complete' message when the
	  target being run is already going to do an installation

2006-09-22 22:12 +0000 [r43518]  Jason Parker <jparker@digium.com>

	* channels/chan_skinny.c: Allow chan_skinny.so to be unloaded
	  properly. Remove reload support, since it doesn't
	  actually...work.

2006-09-22 21:36 +0000 [r43505-43508]  Steve Murphy <murf@digium.com>

	* pbx/pbx_ael.c: This commits a change to return
	  MODULE_LOAD_FAILURE on error, and SUCCESS (instead of 0) when all
	  goes well for bug 8004

	* pbx/pbx_ael.c: If the extensions.ael file not found, or
	  unreadable, we return AST_MODULE_LOAD_DECLINE, as per bug # 8004.

2006-09-22 17:25 +0000 [r43492]  Jason Parker <jparker@digium.com>

	* main/cli.c: Make sure we explicitly set the CLI command to not be
	  deprecated, if it isn't.

2006-09-22 16:42 +0000 [r43486-43489]  Kevin P. Fleming <kpfleming@digium.com>

	* sounds/Makefile: use rebuilt extra sounds

	* main/channel.c: all the Linux systems I have don't use
	  '__m_count' for this field, so I don't know where this came
	  from...

2006-09-22 15:47 +0000 [r43477-43484]  Russell Bryant <russell@digium.com>

	* include/asterisk/threadstorage.h: backport the compatability fix
	  to use attribute_malloc instaed of __attribute__ ((malloc))

	* channels/chan_misdn.c: return AST_MODULE_LOAD_DECLIDE if mISDN
	  could not be configured (issue #8006, Mithraen)

	* main/frame.c: Suppress a compiler warning about the use of a
	  potentially uninitialized variable. It couldn't actually happen,
	  though.

2006-09-22 03:01 +0000 [r43469]  Jason Parker <jparker@digium.com>

	* channels/chan_skinny.c: First shot at unload_module in
	  chan_skinny.. More to come.

2006-09-21 23:50 +0000 [r43466]  Matt O'Gorman <mogorman@digium.com>

	* include/asterisk/jabber.h, channels/chan_gtalk.c,
	  res/res_jabber.c: updates for better compontent support

2006-09-21 23:24 +0000 [r43464]  Tilghman Lesher <tilghman@mail.jeffandtilghman.com>

	* res/res_odbc.c, configs/res_odbc.conf.sample: Twould help if we
	  actually documented how the new features in res_odbc actually
	  work. (Oops)

2006-09-21 22:21 +0000 [r43454-43456]  Joshua Colp <jcolp@digium.com>

	* channels/chan_oss.c: Some more clean up in the load function for
	  chan_oss (issue #8002 reported by Mithraen with minor mods by
	  moi)

	* channels/chan_mgcp.c: Clean up chan_mgcp's module load function
	  (issue #8001 reported by Mithraen with mods by moi)

2006-09-21 21:21 +0000 [r43450]  Kevin P. Fleming <kpfleming@digium.com>

	* main/Makefile, build_tools/strip_nonapi (added): add another
	  attempt to strip non-API symbols from the final binary... script
	  will need to be extended to work on non-Linux systems

2006-09-21 20:22 +0000 [r43410-43445]  Tilghman Lesher <tilghman@mail.jeffandtilghman.com>

	* apps/app_url.c: Fix documentation to reflect how Url() really
	  works

	* cdr/cdr_tds.c, configure, configure.ac: TDS 0.64 updates

2006-09-21  Kevin P. Fleming  <kpfleming@digium.com>

	* Asterisk 1.4.0-beta2 released.

2006-09-21 16:08 +0000 [r43404-43405]  Kevin P. Fleming <kpfleming@digium.com>

	* main/Makefile: remove this change... it requires binutils 2.17

2006-09-20 23:19 +0000 [r43396]  Jason Parker <jparker@digium.com>

	* build_tools/make_version: fix minor typo in the way version is
	  handled

2006-09-20  Kevin P. Fleming  <kpfleming@digium.com>

	* Asterisk 1.4.0-beta1 released.
